var MY_UTILS=function(e){function t(e){try{return e=JSON.parse(e)}catch(t){return e}}var n={$document:e(document),$window:e(window),$body:e("body"),$scrollRoot:e("html, body"),$functionElems:null,$targetElems:null,selectors:{functionElement:"[data-fn]",targetElement:"[data-tg]"},attributes:{target:"data-fn-target",options:"data-fn-options"},classes:{open:"show",animating:"animating",animatingIn:"animating-in",animatingOut:"animating-out"},mediaSize:null,mediaSizes:[{breakpoint:0,label:"xs"},{breakpoint:576,label:"sm"},{breakpoint:768,label:"md"},{breakpoint:992,label:"lg"},{breakpoint:1200,label:"xl"}],anchorOffsetTop:0},a=e(n.selectors.functionElement+", "+n.selectors.targetElement);n.$functionElems=a.filter(n.selectors.functionElement),n.$targetElems=a.filter(n.selectors.targetElement);var o=n.$functionElems.filter('[data-fn="anchor-offset-elem"]');e.fn._getAnchorOffset=function(){return(o.length>0?this.outerHeight():0)+20},n.anchorOffsetTop=o._getAnchorOffset(),n.$window.on("sizeChange",function(){n.anchorOffsetTop=o._getAnchorOffset()}),e.fn.getTransitionDuration=function(){var e=0,t="transition-duration",n=["webkit","ms","moz","o"];if(this.css(t))e=this.css(t);else for(i=0;i<n.length;i++)if(this.css("-"+n[i]+"-"+t)){e=this.css("-"+n[i]+"-"+t);break}return e.indexOf("ms")>-1?parseFloat(e):1e3*parseFloat(e)},e.fn.setRemoveAnimationClass=function(t){t||n.classes.animating;var a=e(this),i=a.getTransitionDuration();if(i>0){a.addClass(t);setTimeout(function(){a.removeClass(t)},i)}},e.fn.elemPositionedInside=function(t){var n=e(this),a=e(t),i=n.offset().left,o=n.offset().top,l=n.width(),r=n.height(),s=a.offset().left,d=a.offset().top,c=a.outerWidth(),u=a.outerHeight();return i>=s&&i+l<=s+c&&o>=d&&o+r<=d+u},e.fn.ariaExpanded=function(n){return void 0!==n?(e(this).attr("aria-expanded",n),n):t(e(this).attr("aria-expanded"))},e.fn.aria=function(n,a){return void 0!==a?(e(this).attr("aria-"+n,a),a):t(e(this).attr("aria-"+n))};return _getmediaSize=function(){var e;if(window.matchMedia)for(i=0;i<n.mediaSizes.length-1;i++){if(window.matchMedia("(max-width: "+(n.mediaSizes[i+1].breakpoint-1)+"px)").matches){e=n.mediaSizes[i].label;break}e=n.mediaSizes[n.mediaSizes.length-1].label}else for(i=0;i<n.mediaSizes.length-1;i++){if(n.$window.width()<n.mediaSizes[i+1].breakpoint){e=n.mediaSizes[i].label;break}e=n.mediaSizes[n.mediaSizes.length-1].label}e!=n.mediaSize&&(n.$body.removeClass("media-"+n.mediaSize),n.$body.addClass("media-"+e),n.mediaSize=e,n.$window.trigger("sizeChange"))},n.$document.ready(function(){_getmediaSize(),n.$window.trigger("sizeChangeReady")}),n.$window.on("resize",function(){_getmediaSize()}),e.fn.getOptionsFromAttr=function(){var t=e(this).attr(n.attributes.options);return void 0!==t&&new Function("return "+t)()},n}(jQuery),DIB_ELECTION_CALCULATOR=(jQuery,{getResult:function(e){function t(e){return{error:e}}function n(e){return JSON.stringify(e,null,2)}function a(e){console.log(e)}function i(e){return s.filter(t=>t.selected&&t.candidate[e]).length}function o(e){return i(e)>=f[e]}a("***********"),a("** INPUT **"),a("***********"),a(n(e)),a("***********");for(var l=0;l<e.structure.length&&e.structure[l].name!=e.current;)l++;if(l>=e.structure.length)return t("current election is not configured");var r=e.structure[l];if(!r.joint&&1!=r.count)return t("only joint elections implemented");var s=e.candidates.filter(e=>Number(e.yes)>Number(e.no));for(var d of s)d.priority=[Number(d.yes),-Number(d.no),Math.random()];s.sort(function(e,n){return function(e,n){if(e.length!=n.length)return t("array lengths for lexical order comparison differ");for(var a=0;a<e.length;a++)if(diff=n[a]-e[a],diff)return diff;return 0}(e.priority,n.priority)});for(var d of s)delete d.priority;a("successful candidates: "+n(s));var c=s.slice().reverse(),u=r.count;r.overall&&(u+=e.previous.length);var f={female:1==u?0:u+1>>1,diverse:u+1>>2};if(a("quotas: "+n(f)),r.overall){for(var m of["female","diverse"])for(var g of e.previous)g.candidate[m]&&f[m]--;a("remaining quotas in overall election: "+n(f))}for(var m in f)f[m]>u&&(a("more reservations for "+m+" candidates than offices"),f[m]=u);for(var v=0;v<r.count&&v<s.length;v++)s[v].selected=!0;if(s.length<=r.count)a((s.length==r.count?"as many successful candidates as":"fewer successful candidates than")+" offices -- all successful candidates have been elected");else{function p(e){var t=e.name;return e.female&&(t+=" (f)"),e.diverse&&(t+=" (v)"),t}function h(){a("------------------------------------------------------------------")}function _(){for(var e of s)a((e.selected?"** ":"   ")+p(e.candidate));h()}a("initial selection:"),_();function b(e){return s.find(t=>e(t)&&!t.selected)}function S(e){return c.find(t=>e(t)&&t.selected)}function y(e){return b(t=>t.candidate[e])}function C(e){return S(t=>!t.candidate[e])}function E(e,t){a("replacing "+t.candidate.name+" by "+e.candidate.name),e.selected=!0,t.selected=!1}if(f.diverse){for(a("ensuring diversity quota"),h();!o("diverse");){if(!(x=y("diverse"))){a("not enough successful candidates to fulfil diversity quota");break}if(!(w=C("diverse")))return t("more reservations for diversity than offices");E(x,w),_()}var $=o("diverse");a($?"diversity quota fulfilled":"diversity quota not fulfilled"),_(),$||(f.diverse=i("diverse"))}else a("no diversity quota applies");if(f.female){for(a("ensuring women's quota"),h();!o("female");){var x;if(!(x=y("female"))){a("not enough successful candidates to fulfil women's quota");break}var w;if(!(w=C("female")))throw new Error("more reservations for women than offices");if(E(x,w),!o("diverse")){a("replacement violated diversity quota -- undoing"),E(w,x);var k=S(e=>!e.candidate.female&&!e.candidate.diverse);if(k)w=k;else{var I=b(e=>e.candidate.female&&e.candidate.diverse);I?x=I:a("cannot make a replacement without violating diversity quota -- women's quota can't be fulfilled")}E(x,w)}_()}a(o("female")?"women's quota fulfilled":"women's quota not fulfilled"),h()}else a("no women's quota applies")}a("Final selection:");for(var O of s.filter(e=>e.selected))a(O.candidate.name);var T={};T.candidates=s.filter(e=>e.selected).map(function(e){return{candidate:e.candidate}}),a("output: "+n(T));for(var d of s)delete d.selected;return T}});!function(){var e=/iPad|iPhone|iPod/.test(navigator.platform)&&!window.MSStream,t=/(android)/i.test(navigator.userAgent);e?document.body.className+=" is-ios":t&&(document.body.className+=" is-android");var n=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var n=e.indexOf("rv:");return parseInt(e.substring(n+3,e.indexOf(".",n)),10)}var a=e.indexOf("Edge/");return a>0&&parseInt(e.substring(a+5,e.indexOf(".",a)),10)}();if(!1!==n&&n>9)for(document.body.className+=" ie ie"+n,i=n;i<=14;i++)document.body.className+=" ielte"+i;if(e){var a=document.body.children;for(i=0;i<a.length;i++)"DIV"==a[i].tagName&&a[i].setAttribute("onclick","void(0);")}}(),function(e,t){e.fn.animatedAnchors=function(n){var a=e(this);if(n=e.extend({},{scrollToInitialHash:!0,scrollDurationMin:300,scrollDurationMax:800,scrollDurationPer1000:400,offset:function(){return 0},scrollTolerance:1,fixedClass:"fixed"},n),e.fn._animatedScrollTo=function(){$this=e(this);var a=t.$window.scrollTop(),i=$this.offset().top+n.scrollTolerance,o=Math.abs(i-n.offset()-a)*n.scrollDurationPer1000/1e3;o<n.scrollDurationMin?o=n.scrollDurationMin:o>n.scrollDurationMax&&(o=n.scrollDurationMax),t.$scrollRoot.animate({scrollTop:i-n.offset()},o)},n.scrollToInitialHash){var i=e(window.location.hash);window.location.hash&&i.length>0&&(i._animatedScrollTo(),t.$window.on("load",function(){i._animatedScrollTo()}))}a.each(function(){var t=e(this);t.on("click",function(){var n=t.attr("href"),a=e(n);a.length>0&&a._animatedScrollTo()})})}}(jQuery,MY_UTILS),function(e,t){e.fn.checkSlideToggle=function(n){var a={effectIn:"slideDown",effectOut:"slideUp",effectDuration:400,triggerSelector:'input[type="checkbox"]',openedClass:t.classes.open,animatingClass:t.classes.animating,animatingInClass:t.classes.animatingIn,animatingOutClass:t.classes.animatingOut};n=e.extend({},a,n);e(this).each(function(){var t=e(this),a=t.find(n.triggerSelector),i=t.find(e(a.attr("aria-controls")));a.is(":checked")?(t.addClass(n.openedClass),a.ariaExpanded(!0),i.show()):(t.removeClass(n.openedClass),a.ariaExpanded(!1),i.hide()),a.on("change",function(){a.ariaExpanded()?(t.addClass(n.animatingClass).addClass(n.animatingOutClass).removeClass(n.openedClass),a.ariaExpanded(!1),i.stop()[n.effectOut](n.effectDuration,function(){t.removeClass(n.animatingClass).removeClass(n.animatingOutClass)})):(t.addClass(n.animatingClass).addClass(n.animatingInClass),a.ariaExpanded(!0),i.stop()[n.effectIn](n.effectDuration,function(){t.addClass(n.openedClass).removeClass(n.animatingClass).removeClass(n.animatingInClass)}))})})}}(jQuery,MY_UTILS),function(e,t,n){function a(e){var n="Bei der Berechnung des Wahlergebnisses ist leider ein unbekannter Fehler aufgetreten.";e.message,n=e.message;t.$targetElems.filter('[data-tg="confirm-modal"]')._confirmModal({header:"Fehler",headerClass:"modal-title text-warning",body:n,confirmButtonHide:!0,dismissButtonClass:"btn btn-primary btn-warning",dismissButtonIconClass:"fa fa-check",dismissButtonText:"Ok"})}var i={Vorstand:[{name:"Vorsitzende",count:2},{name:"Schatzmeister*in",count:1},{name:"weitere Mitglieder",count:"variable",countVariable:!0,overall:!0}],Schiedsgericht:[{name:"Richter*innen",count:3},{name:"Ersatzrichter*innen",count:2,overall:!0}],"Kassenprüfer*innen":[{name:"Kassenprüfer*innen",count:2}]},o="currentElectionConfig";localStorage.getItem(o)&&(l=JSON.parse(localStorage.getItem(o)));var l,r=new URL(document.location.href).searchParams.get("preset");2==r?l={Vorstand:[{name:"Vorsitzende",count:2,joint:!0,candidates:[{candidate:{name:"Lina Limone",female:!0,diverse:!1},yes:18,no:2},{candidate:{name:"Manfred Mango",female:!1,diverse:!1},yes:12,no:1},{candidate:{name:"Olivia Orange",female:!0,diverse:!0},yes:12,no:0}]},{name:"Schatzmeister*in",count:1,candidates:[{candidate:{name:"Anna Ananas",female:!0,diverse:!0},yes:12,no:4},{candidate:{name:"Cora Cocos",female:!0,diverse:!1},yes:7,no:1}]},{name:"weitere Mitglieder",count:3,countVariable:!0,overall:!0,joint:!1,candidates:[[{candidate:{name:"Maria Maracuja",female:!0,diverse:!0},yes:12,no:0},{candidate:{name:"Bernard Banane",female:!1,diverse:!1},yes:12,no:1}],[{candidate:{name:"Kira Kirsch-Banane",female:!0,diverse:!1},yes:18,no:2},{candidate:{name:"Alfred Apfel",female:!1,diverse:!0},yes:11,no:3},{candidate:{name:"Anna Ananas",female:!0,diverse:!0},yes:12,no:4},{candidate:{name:"Cora Cocos",female:!0,diverse:!1},yes:7,no:1}],[{candidate:{name:"Kilian Kiwi",female:!1,diverse:!0},yes:7,no:0},{candidate:{name:"Mandy Mandarine",female:!0,diverse:!0},yes:8,no:2},{candidate:{name:"Melly Melone",female:!0,diverse:!1},yes:15,no:3}]]}]}:1==r&&(l={Vorstand:[{name:"Vorsitzende",count:2,joint:!0,candidates:[{candidate:{name:"Lina Limone",female:!0,diverse:!1},yes:18,no:2},{candidate:{name:"Manfred Mango",female:!1,diverse:!1},yes:12,no:1},{candidate:{name:"Olivia Orange",female:!0,diverse:!0},yes:12,no:0}],results:[{candidate:{name:"Lina Limone",female:!0,diverse:!1}},{candidate:{name:"Manfred Mango",female:!1,diverse:!1}}]},{name:"Schatzmeister*in",count:1,candidates:[{candidate:{name:"Kilian Kiwi",female:!1,diverse:!0},yes:7,no:0},{candidate:{name:"Mandy Mandarine",female:!0,diverse:!0},yes:8,no:2},{candidate:{name:"Melly Melone",female:!0,diverse:!1},yes:15,no:3}],results:[{candidate:{name:"Melly Melone",female:!0,diverse:!1}}]},{name:"weitere Mitglieder",count:3,countVariable:!0,overall:!0,joint:!0,candidates:[{candidate:{name:"Maria Maracuja",female:!0,diverse:!0},yes:12,no:0},{candidate:{name:"Bernard Banane",female:!1,diverse:!1},yes:12,no:1},{candidate:{name:"Kira Kirsch-Banane",female:!0,diverse:!1},yes:18,no:2},{candidate:{name:"Alfred Apfel",female:!1,diverse:!0},yes:11,no:3},{candidate:{name:"Anna Ananas",female:!0,diverse:!0},yes:12,no:4},{candidate:{name:"Cora Cocos",female:!0,diverse:!1},yes:7,no:1}]}],Schiedsgericht:[{name:"Richter*innen",count:3,joint:!0,candidates:[{candidate:{name:"Pablo Papaya",female:!1,diverse:!0},yes:8,no:0},{candidate:{name:"Lydia Litschi",female:!1,diverse:!1},yes:5,no:1},{candidate:{name:"Eduard Erdbeere",female:!0,diverse:!0},yes:7,no:0}]},{name:"Ersatzrichter*innen",count:2,joint:!0,overall:!0,candidates:[{candidate:{name:"Holly Holunder",female:!0,diverse:!1},yes:15,no:1},{candidate:{name:"Hila Himbeere",female:!0,diverse:!0},yes:9,no:0}]}]});var s=void 0!==l?e.extend({},i,l):e.extend({},i),d='[data-tg="election-step-',c='[data-fn="election-step-form-',u='[data-fn="election-step-select-',f='[data-tg="election-item-template-',m='[data-tg="election-item-append-',g="data-g-tg",v="election-item",p="data-item-id",h='[data-tg="election-subitem-template-',_='[data-g-tg="election-subitem-append-',b="data-g-tg",S="election-subitem",y="data-subitem-id",C="data-confirm-delete",E=[],$=[],x="name";E[0]={check:{selector:'[id^="election-check-"]',value:"true",name:"election_"}},$[0]={count:{selector:'[id^="election-count-"]',value:"",name:"count_"},joint:{selector:'[id^="election-joint-"]',value:"true",name:"joint_",saveAs:"joint"}},$[1]={name:{selector:'[id^="name-"]',value:"",name:"name_",confirmSubitemDelete:!0,saveAs:"name"},female:{selector:'[id^="female-check-"]',value:"true",name:"female_",saveAs:"female"},diverse:{selector:'[id^="diverse-check-"]',value:"true",name:"diverse_",saveAs:"diverse"}},$[2]={yes:{selector:'[id^="votes-yes-"]',value:"",name:"yes_",saveAs:"yes"},no:{selector:'[id^="votes-no-"]',value:"",name:"no_",saveAs:"no"}};var w='<option value="-1" selected>Alle</option>';e.fn._replaceTemplatePlaceholders=function(t){var n=e(this);if(n.length>0){for(var a=0;a<t.length;a++){var i="{{ "+t[a][0]+" }}",o=new RegExp(i,"g");n.html(n.html().replace(o,t[a][1]))}return n}},_checkElectionConfigCandidatesOrVotes=function(e,t,n){var a=Object.keys(s)[e];if(!a||void 0===t)return!1;console.log("key: "+a+" – i: "+t+" – j: "+n);_validCandidatesOrVotes=function(e){var t=!1,n=!1;if(void 0!==e){for(var a=0;a<e.length;a++)void 0===e[a].candidate&&(t=!0),void 0!==e[a].yes&&void 0!==e[a].no||(n=!0);return[!t,!n]}return[!1,!1]};var i;void 0!==s[a]&&void 0!==s[a][t]&&void 0!==s[a][t].candidates&&s[a][t].candidates.length>0&&(void 0===n?void 0!==s[a][t].candidates[0]&&(i=s[a][t].candidates):void 0!==s[a][t].candidates[n]&&s[a][t].candidates[n].length>0&&(i=s[a][t].candidates[n]));var o=_validCandidatesOrVotes(i);return[o[0],o[1]]};_validateItems=function(){console.log("_validateItems()");for(var e in s){Object.keys(s).indexOf(e);for(var t=0;t<s[e].length;t++)if(void 0!==s[e]&&void 0!==s[e][t]&&void 0!==s[e][t].candidates&&void 0!==s[e][t].candidates[0])if(void 0!==s[e][t].candidates[0].candidate)console.log("joint, has candidate");else if(void 0!==s[e][t].candidates[0][0]&&void 0!==s[e][t].candidates[0][0].candidate)for(var n=0;n<s[e][t].candidates.length;n++)console.log("single"),void 0!==s[e][t].candidates[n][0]&&void 0!==s[e][t].candidates[n][0].candidate?console.log(n+" has candidate"):console.log(n+" has no candidate");else console.log("has no candidates 2");else console.log("has no candidates 1")}},e.fn._addSublistItems=function(n,a,i,o,l){var r=n||1,s=a,d=i,c=o,u=void 0!==c&&l?l[c]:l,f=e(this),m=t.$targetElems.filter(h+1+'"]'),g=f.find(_+1+'"]'),v=f.find("["+y+"]").last(),E=0;v.length>0&&(E=parseInt(v.attr(y))+1);for(var w=0;w<r;w++){var k=E+w,I=m.clone();I._replaceTemplatePlaceholders([["itemIndex",s],["subitemgroupIndex",d],["subitemIndex",void 0!==c?c+"-"+k:k]]).removeAttr("style data-tg").attr(b,S).attr(y,k).show().find('[data-g-fn="election-subitem-remove"]').on("click",function(t){t.preventDefault();var n=e(this).closest("["+b+'="'+S+'"]'),a=n.find("input["+C+"]");if(a.length>0){var i=!1;a.each(function(){""!=(T=e(this)).val()&&(i=!0,T.addClass("is-invalid").on("focus",function(){e(this).removeClass("is-invalid")}))}),i||n.remove()}else n.remove()});for(var O in $[1]){var T=I.find($[1][O].selector),V=f.attr(p);T.length>0&&(T.attr(x,$[1][O].name+V+"_"+k).attr("value",$[1][O].value),$[1][O].confirmSubitemDelete&&T.attr(C,""))}for(var O in $[2]){T=I.find($[2][O].selector),V=f.attr(p);T.length>0&&(T.attr(x,$[2][O].name+V+"_"+k).attr("value",$[2][O].value),$[2][O].confirmSubitemDelete&&T.attr(C,""))}u&&u[w]&&u[w].candidate&&(u[w].candidate.name&&""!=u[w].candidate.name&&I.find('input[name^="name"]').val(u[w].candidate.name),u[w].candidate.female&&I.find('input[name^="female"]').attr("checked",""),u[w].candidate.diverse&&I.find('input[name^="diverse"]').attr("checked",""),void 0!==u[0].yes&&I.find('input[name^="yes"]').val(u[w].yes),void 0!==u[0].no&&I.find('input[name^="no"]').val(u[w].no)),I.appendTo(g)}},e.fn._validateNumberInput=function(){var t=e(this),n=t.find('[data-g-fn="validate"]');if(n.length>0){var a=t.find(n.attr("data-g-tg"));n.on("change keyup",function(){var t=e(this),n=parseInt(t.attr("min")),i=parseInt(t.attr("max")),o=t.val();console.log("min: "+n+" – max: "+i),"NaN"==typeof n&&"NaN"==typeof man||""==o||("NaN"!=typeof n&&o<n?t.val(n):"NaN"!=typeof man&&o>i&&t.val(i)),a.length>0&&(o>1?a.show():a.hide())})}},e.fn._getFormValues=function(t){var n=e(this),a={},i=t||"name";return n.find("input["+i+"], select["+i+"], textarea["+i+"]").each(function(t,n){var o=e(n);"radio"==o.attr("type")?o.is(":checked")&&(a[o.attr(i)]=o.val()):"checkbox"==o.attr("type")?a[o.attr(i)]=o.is(":checked")?o.val():null:a[o.attr(i)]=o.val()}),a},_filterMatchingIndexes=function(e,t){for(var n=[],a=0;a<e.length;a++)0===e[a].indexOf(t)&&n.push(e[a]);return n},_getElectionResult=function(){var e=!1;for(var t in s){for(var i={structure:[],current:"",previous:[],candidates:[]},l=["name","count","joint","overall"],r=0;r<s[t].length;r++){i.structure.push({});for(var d=0;d<l.length;d++)void 0!==s[t][r][l[d]]&&(i.structure[r][l[d]]=s[t][r][l[d]])}for(r=0;r<s[t].length;r++){_setPrevious=function(){if(0===r)i.previous=[];else{var e=r-1;if(void 0!==s[t][e].results&&void 0!==s[t][e].results.candidates&&s[t][e].results.candidates.length>0)for(var n=0;n<s[t][e].results.candidates.length;n++)i.previous.push(s[t][e].results.candidates[n])}};var c=!1,u=!1;if(void 0!==s[t][r]&&void 0!==s[t][r].candidates&&s[t][r].candidates.length>0&&void 0!==s[t][r].candidates[0].candidate){for(d=0;d<s[t][r].candidates.length;d++)void 0!==s[t][r].candidates[d].yes&&void 0!==s[t][r].candidates[d].no?"0"==s[t][r].candidates[d].yes&&"0"==s[t][r].candidates[d].no||(c=!0):u=!0;if(c&&!u){i.current=s[t][r].name,_setPrevious(),i.candidates=s[t][r].candidates;var f=n.getResult(i);return e=!0,a({message:"Dies ist nur ein Testfehler."}),!1}}else if(void 0!==s[t][r]&&void 0!==s[t][r].candidates&&s[t][r].candidates.length>0&&void 0===s[t][r].candidates[0].candidate&&s[t][r].candidates[0].length>0&&void 0!==s[t][r].candidates[0][0].candidate){_setPrevious();for(var m=0;m<s[t][r].candidates.length;m++){for(d=0;d<s[t][r].candidates[m].length;d++)void 0!==s[t][r].candidates[m][d].yes&&void 0!==s[t][r].candidates[m][d].no?"0"==s[t][r].candidates[m][d].yes&&"0"==s[t][r].candidates[m][d].no||(c=!0):u=!0;if(c&&!u){i.current=[s[t][r].name,m],0===m&&(s[t][r].results={candidates:[],explanation:[]}),i.candidates=s[t][r].candidates[m];void 0!==(f=n.getResult(i)).error?(e=!0,a(f.error)):(s[t][r].results.candidates.push(f.candidates[0]),i.previous.push(f.candidates[0]))}}}}}return f&&localStorage.setItem(o,JSON.stringify(s)),!e},e.fn._getElectionCurrentConfig_0=function(){s=void 0!==l?e.extend({},i,l):e.extend({},i);var t=e(this)._getFormValues(x),n=[];for(var a in s){var r=Object.keys(s).indexOf(a);if(null===t[E[0].check.name+r])n.push(a);else for(var d=0;d<s[a].length;d++){var c=t[$[0].count.name+r+"_"+d];c&&(c=parseInt(c));var u=t[$[0].joint.name+r+"_"+d];u&&(u=JSON.parse(u)),null!=c?s[a][d].count=c:c=s[a][d].count,null!=u?s[a][d].joint=!0:c>1&&(s[a][d].joint=!1),c>1&&!u?void 0!==s[a][d].candidates&&void 0!==s[a][d].candidates[0]&&void 0!==s[a][d].candidates[0].candidate&&delete s[a][d].candidates:void 0!==s[a][d].candidates&&void 0!==s[a][d].candidates[0]&&void 0!==s[a][d].candidates[0][0]&&void 0!==s[a][d].candidates[0][0].candidate&&delete s[a][d].candidates}}for(var f=0;f<n.length;f++)delete s[n[f]];localStorage.setItem(o,JSON.stringify(s))},e.fn._getElectionCurrentConfig_1=function(){var t=e(this);_isValidCandidate=function(e){return void 0!==n[e]&&null!==n[e]&&""!==n[e]},_getCandidate=function(e){var t=n[e],a=n[e.replace(m,g)]||!1,i=n[e.replace(m,v)]||!1;return{[$[1].name.saveAs]:t,[$[1].female.saveAs]:a,[$[1].diverse.saveAs]:i}};var n=t._getFormValues(x);for(var a in s)for(var i=Object.keys(s).indexOf(a),l=0;l<s[a].length;l++){s[a][l].candidates=[];s[a][l].name;var r,d,c=parseInt(s[a][l].count),u=s[a][l].joint,f=Object.keys(n),m=$[1].name.name,g=$[1].female.name,v=$[1].diverse.name,h=$[2].yes.name,_=$[2].no.name;if(1===c||!0===u){t.find("["+p+'="'+i+"_"+l+'"]').find("["+y+"]");r=i+"_"+l+"_",d=_filterMatchingIndexes(f,m+r);for(var b=0,S=0;S<d.length;S++)if(_isValidCandidate(d[S])){var C=_getCandidate(d[S]),E=n[d[S].replace(m,h)]||!1,w=n[d[S].replace(m,_)]||!1;void 0===s[a][l].candidates&&(s[a][l].candidates=[]),void 0===s[a][l].candidates[S-b]&&(s[a][l].candidates[S-b]={}),s[a][l].candidates[S-b].candidate=C,E&&(s[a][l].candidates[S-b].yes=E),w&&(s[a][l].candidates[S-b].no=w)}else b++}else for(var k=0;k<c;k++){r=i+"_"+l+"_"+k+"_",d=_filterMatchingIndexes(f,m+r),s[a][l].candidates[k]=[];for(b=0,S=0;S<d.length;S++)if(_isValidCandidate(d[S])){C=_getCandidate(d[S]),E=n[d[S].replace(m,h)]||!1,w=n[d[S].replace(m,_)]||!1;void 0===s[a][l].candidates[k][S-b]&&(s[a][l].candidates[k][S-b]={}),s[a][l].candidates[k][S-b].candidate=C,E&&(s[a][l].candidates[k][S-b].yes=E),w&&(s[a][l].candidates[k][S-b].no=w)}else b++}}localStorage.setItem(o,JSON.stringify(s))},e.fn._getElectionCurrentConfig_2=function(){var t=e(this),n=t._getFormValues(x);for(var a in s)for(var i=Object.keys(s).indexOf(a),l=0;l<s[a].length;l++){s[a][l].name;var r,d,c=parseInt(s[a][l].count),u=s[a][l].joint,f=Object.keys(n),m=$[2].yes.name,g=$[2].no.name;if(1===c||!0===u){t.find("["+p+'="'+i+"_"+l+'"]').find("["+y+"]");r=i+"_"+l+"_",d=_filterMatchingIndexes(f,m+r);for(var v=0;v<d.length;v++){var h=n[d[v]]||0,_=n[d[v].replace(m,g)]||0;s[a][l].candidates[v].yes=h,s[a][l].candidates[v].no=_}}else for(var b=0;b<c;b++){r=i+"_"+l+"_"+b+"_",d=_filterMatchingIndexes(f,m+r);for(v=0;v<d.length;v++){h=n[d[v]]||0,_=n[d[v].replace(m,g)]||0;s[a][l].candidates[b][v].yes=h,s[a][l].candidates[b][v].no=_}}}localStorage.setItem(o,JSON.stringify(s))},_buildStep_3=function(){var e=t.$targetElems.filter(f+3+'"]'),n=t.$targetElems.filter(m+3+'"]'),a=t.$targetElems.filter('[data-tg="election-subitemgroup-template-3"]'),i=t.$targetElems.filter(h+3+'"]');n.empty();for(var o in s){var l=Object.keys(s).indexOf(o),r=o,c=e.clone();c.removeAttr("data-tg style")._replaceTemplatePlaceholders([["title",r],["index",l]]);for(var u=c.find('[data-g-tg="election-subitemgroup-append-3"]'),g=0;g<s[o].length;g++){var v=s[o][g].name,p=a.clone();if(p._replaceTemplatePlaceholders([["index",g],["title",v]]).removeAttr("style data-tg").show(),void 0!==s[o][g].results&&void 0!==s[o][g].results.candidates&&s[o][g].results.candidates.length>0)for(var b=p.find(_+3+'"]'),S=0;S<s[o][g].results.candidates.length;S++){var y=i.clone(),C=s[o][g].results.candidates[S].candidate.name||"";y._replaceTemplatePlaceholders([["candidateName",C]]).removeAttr("style data-tg").show(),0==S&&""!=C&&b.empty(),""!=C&&y.appendTo(b)}if(void 0!==s[o][g].results&&void 0!==s[o][g].results.explanation&&s[o][g].results.explanation.length>0){console.log("explanation found");for(var E=t.$targetElems.filter('[data-tg="explanation-template"]'),$=p.find('[data-g-tg="explanation-template-append"]'),x=(t.$targetElems.filter('[data-g-tg="explanation-subitem-text"]'),t.$targetElems.filter('[data-g-tg="explanation-subitem-list"]'),s[o][g].results.explanation),w=0;w<x.length;w++){console.log("explanation j: "+w);var k=E.clone();k._replaceTemplatePlaceholders([["headline",x[w].headline]]).removeAttr("style data-tg").show();var I=k.find('[data-g-tg="explanation-item-append"]');for(S=0;S<x[w].content.length;S++){console.log("explanation["+w+"] k: "+S);var O=x[w].content[S],T=t.$targetElems.filter('[data-tg="explanation-item-'+O.type+'"]').clone();T._replaceTemplatePlaceholders([["itemHeadline",O.headline]]).removeAttr("style data-tg").show();for(var V=T.find('[data-g-tg="explanation-subitem-append"]'),D=O.items,M=0;M<D.length;M++){console.log("subitem["+M+"].item: "+D[M].item);var B=t.$targetElems.filter('[data-tg="explanation-subitem-'+O.type+'"]').clone();if(B._replaceTemplatePlaceholders([["subitemContent",D[M].item]]).removeAttr("style data-tg").show(),!D[M].selected){var A=B.attr("data-selected-class");B.addClass(A)}B.appendTo(V)}T.appendTo(I)}k.appendTo($)}}p.appendTo(u)}c.appendTo(n),t.$targetElems.filter(d+3+'"]').show()}},_buildStep_2=function(){var n=t.$functionElems.filter(c+2+'"]'),a=t.$targetElems.filter(f+2+'"]'),i=t.$targetElems.filter(m+2+'"]'),o=t.$targetElems.filter(h+2+'"]');i.empty(),k.$select[2].empty().append(w);for(var l in s)for(var r=Object.keys(s).indexOf(l),d=l,u=0;u<s[l].length;u++){var C,E=s[l][u].name,I=parseInt(s[l][u].count),O=s[l][u].joint,T=s[l][u].candidates;if(_cloneStep_2=function(e){var t=a.clone(),n=e;k.$select[2].append('<option value="'+r+"_"+u+(void 0!==n?"_"+n:"")+'">'+C+"</option>"),t.removeAttr("data-tg style").attr(g,v).attr(p,void 0!==n?r+"_"+u+"_"+n:r+"_"+u)._replaceTemplatePlaceholders([["title",C]]);var l;l=void 0!==n&&void 0!==T&&void 0!==T[n]&&T[n].length>0?T[n].length:void 0===n&&void 0!==T&&void 0!==T[0]&&void 0!==T[0].candidate&&T.length>0?T.length:0;for(var s=void 0!==n&&T?T[n]:T,d=t.find(_+2+'"]'),c=0;c<l;c++){var f=o.clone(),m=s[c].candidate.name||"";f._replaceTemplatePlaceholders([["candidateName",m],["itemIndex",r],["subitemgroupIndex",u],["subitemIndex",void 0!==n?n+"-"+c:c]]).removeAttr("style data-tg").attr(b,S).attr(y,c).show()._validateNumberInput();for(var h in $[2]){var E=f.find($[2][h].selector),w=t.attr(p);E.length>0&&E.attr(x,$[2][h].name+w+"_"+c).attr("value",$[2][h].value)}s&&s[c]&&s[c].candidate&&(void 0!==s[c].yes&&f.find('input[name^="yes"]').val(s[c].yes),void 0!==s[c].no&&f.find('input[name^="no"]').val(s[c].no)),f.appendTo(d)}t.appendTo(i)},1==I)C=d+" » "+E,_cloneStep_2();else if(O)C=d+" » "+E+" (gemeinsam "+I+")",_cloneStep_2();else for(var V=0;V<I;V++)C=d+" » "+E+" » "+(V+1)+"&thinsp;/&thinsp;"+I,_cloneStep_2(V)}$CalculateElectionButton=t.$functionElems.filter('[data-fn="calculate-election"]'),$CalculateElectionButton.off("click.calculate").on("click.calculate",function(e){e.preventDefault();t.$functionElems.filter(c+2+'"]')._getElectionCurrentConfig_2(),_getElectionResult()&&_buildStep_3()}),n.off("submit.form.2").on("submit.form.2",function(t){t.preventDefault();var n=e(this);n._getElectionCurrentConfig_2(),_getElectionResult()&&(_buildStep_3(),n.trigger("built"))})},_buildStep_1=function(){var n=t.$functionElems.filter(c+1+'"]'),a=t.$targetElems.filter(f+1+'"]'),i=t.$targetElems.filter(m+1+'"]');t.$targetElems.filter(h+1+'"]');i.empty(),k.$select[1].empty().append(w);for(var o in s)for(var l=Object.keys(s).indexOf(o),r=o,d=0;d<s[o].length;d++){var u,_=s[o][d].name,b=parseInt(s[o][d].count),S=s[o][d].joint,y=s[o][d].candidates;if(_cloneStep_1=function(t){var n=a.clone(),o=t;k.$select[1].append('<option value="'+l+"_"+d+(void 0!==o?"_"+o:"")+'">'+u+"</option>"),n.removeAttr("data-tg style").attr(g,v).attr(p,void 0!==o?l+"_"+d+"_"+o:l+"_"+d)._replaceTemplatePlaceholders([["title",u],["index",l]]);var r;r=void 0!==o&&void 0!==y&&void 0!==y[o]&&y[o].length>0?y[o].length:void 0===o&&void 0!==y&&void 0!==y[0]&&void 0!==y[0].candidate&&y.length>0?y.length:1!=b&&S?b+3:4,n._addSublistItems(r,l,d,o,y),n.find('[data-g-fn="add-subitems"]').on("click",function(t){t.preventDefault();var n=e(this).closest("["+g+'="'+v+'"]'),a=n.find('[data-g-tg="add-subitems-count"]').val();n._addSublistItems(a,l,d,o)}),n.appendTo(i)},1==b)u=r+" » "+_,_cloneStep_1();else if(S)u=r+" » "+_+" (gemeinsam "+b+")",_cloneStep_1();else for(var C=0;C<b;C++)u=r+" » "+_+" » "+(C+1)+"&thinsp;/&thinsp;"+b,_cloneStep_1(C)}n.off("submit.form.1").on("submit.form.1",function(t){t.preventDefault();var n=e(this);n._getElectionCurrentConfig_1(),_buildStep_2(),n.trigger("built")})},_buildStep_0=function(){var n=t.$functionElems.filter(c+0+'"]'),a=t.$targetElems.filter(f+0+'"]'),o=t.$targetElems.filter(m+0+'"]'),r=t.$targetElems.filter(h+0+'"]');o.empty();for(var d in i){var u=Object.keys(i).indexOf(d),b=a.clone();b.removeAttr("data-tg style").attr(g,v).attr(p,u)._replaceTemplatePlaceholders([["title",d],["index",u]]);for(var S in E[0]){(I=b.find(E[0][S].selector)).length>0&&(I.attr(x,E[0][S].name+u).attr("value",E[0][S].value),void 0!==l&&l[d]&&I.attr("checked",""))}for(var y=b.find(_+0+'"]'),C=0;C<i[d].length;C++){var w=C,k=r.clone();i[d][C].countVariable?void 0!==s[d]&&void 0!==s[d][C]&&!s[d][C].count>1&&k.find('[data-tp-o="3"]').hide():Number.isInteger(i[d][C].count)&&i[d][C].count>1||k.find('[data-tp-o="3"]').remove(),i[d][C].countVariable?k.find('[data-tp-o="1"]').remove():k.find('[data-tp-o="2"]').remove(),k.removeAttr("data-tg style")._replaceTemplatePlaceholders([["electionItemType",i[d][C].name],["electionItemCount",i[d][C].count],["itemIndex",u],["index",w]])._validateNumberInput();for(var S in $[0]){var I;(I=k.find($[0][S].selector)).length>0&&(I.attr(x,$[0][S].name+u+"_"+w).attr("value",$[0][S].value),I.is('[name^="count"]')&&s[d]&&s[d][C]&&!0===s[d][C].countVariable&&s[d][C].count>0&&I.attr("value",s[d][C].count),I.is('[type="checkbox"]')&&s[d]&&s[d][C]&&s[d][C].joint===JSON.parse($[0].joint.value)&&I.attr("checked",""))}k.appendTo(y)}b.appendTo(o).checkSlideToggle({triggerSelector:'[data-g-fn="accordion-trigger"]'})}n.off("submit.form.0").on("submit.form.0",function(t){t.preventDefault();var n=e(this);n._getElectionCurrentConfig_0(),_buildStep_1(),n.trigger("built")})};var k={steps:3,currentStep:0,previousStep:null,$electionStep:[],$stepPrev:[],$stepNext:[],$select:[],selectValues:[],currentSelectValue:[],currentItemCoordinates:null,electionDoingSelectValue:null};k._getSelectValues=function(t){var n=[];return e(t).find("option").each(function(){n.push(e(this).val())}),n},k._setItem=function(e,t,n){var a=void 0===t?k.currentStep:t;if(k.currentSelectValue[a]=e,console.log("_Nav._setItem (step: "+a+") to: "+e),k.$select[a].find('option[value="'+e+'"]').removeAttr("disabled"),k.$select[a].val(e).trigger("change"),void 0!==n)for(var i=0;i<n.length;i++)k.$select[a].find('option[value="'+n[i]+'"]').removeAttr("disabled").attr("disabled","")},k._gotoStep=function(e,n){console.log("begin nav goto "+e),k.previousStep=k.currentStep,k.currentStep=e,console.log("GOTO: "+k.currentStep+" FROM: "+k.previousStep);for(var a=0;a<k.steps;a++)a!==k.currentStep?k.$electionStep[a].hide():k.$electionStep[a].show();if(1==k.currentStep&&(k.selectValues=k._getSelectValues(k.$select[k.currentStep])),0==k.currentStep&&(k.electionDoingSelectValue=null),k.currentStep>0&&(k.currentSelectValue[k.currentStep]=k.$select[k.currentStep].val(),console.log("_Nav.currentSelectValue[ "+k.currentStep+" ]: "+k.currentSelectValue[k.currentStep])),1==k.currentStep){if(_showMissingElectionsDialog=function(){t.$targetElems.filter('[data-tg="confirm-modal"]')._confirmModal({header:"Hinweis",headerClass:"modal-title",body:"Bitte wähle mindestens eine Wahl aus.",confirmButtonHide:!0,dismissButtonClass:"btn btn-primary",dismissButtonIconClass:"fa fa-check",dismissButtonText:"Ok"})},k.previousStep<k.currentStep&&(console.log("going forward: "+typeof s),"{}"===JSON.stringify(s)))return _showMissingElectionsDialog(),k._gotoStep(0),!1;k.previousStep>k.currentStep&&"-1"!=k.currentSelectValue[k.currentStep]&&k._setItem(k.currentSelectValue[k.currentStep+1])}if(2==k.currentStep){if(_checkForCandidates=function(e){if(void 0!==e){var t=e.split("_");return _checkElectionConfigCandidatesOrVotes(t[0],t[1],t[2])[0]}return!1},_showMissingCandidatesDialog=function(){t.$targetElems.filter('[data-tg="confirm-modal"]')._confirmModal({header:"Hinweis",headerClass:"modal-title",body:"Bitte Kandidaten hinzufügen.",confirmButtonHide:!0,dismissButtonClass:"btn btn-primary",dismissButtonIconClass:"fa fa-check",dismissButtonText:"Ok"})},_increaseSelectValue=function(e,t){return k.electionDoingSelectValue=e,console.log("_Nav.electionDoingSelectValue: "+k.electionDoingSelectValue),k.currentSelectValue[k.currentStep]=e,console.log("_increaseSelectValue: "+e),_checkForCandidates(e)?(console.log("valid"),k._setItem(e,void 0,t),!0):(console.log("candidates missing, go back"),_showMissingCandidatesDialog(),k._gotoStep(1,e),!1)},_getDisableOptionsList=function(e){var t=void 0!==e?e:[],n=null!==k.electionDoingSelectValue?k.selectValues.indexOf(k.electionDoingSelectValue)+1:e.length+1;console.log("DISABLE:");for(var a=n;a<k.selectValues.length;a++)console.log(a+": "+k.selectValues[a]),t.push(k.selectValues[a]);return t},console.log("CHECK IF SET SELECT"),k.previousStep!=k.currentStep)if(console.log(k.previousStep+" != "+k.currentStep),"-1"==k.currentSelectValue[k.currentStep]&&null===k.electionDoingSelectValue){console.log("increase & check");var i=k.selectValues[k.selectValues.indexOf("-1")+1],o=k.electionDoingSelectValue!=k.selectValues[k.selectValues.length-1]?_getDisableOptionsList(["-1"]):void 0;if(!_increaseSelectValue(i,o))return!1}else{console.log("adapting value to doing");i=k.electionDoingSelectValue,o=k.electionDoingSelectValue!=k.selectValues[k.selectValues.length-1]?_getDisableOptionsList(["-1"]):void 0;if(!_checkForCandidates(i)){if(console.log("candidates missing but not first, goint to latest valid election"),k.selectValues.indexOf(k.electionDoingSelectValue)-1>0){i=k.selectValues[k.selectValues.indexOf(k.electionDoingSelectValue)-1];k.electionDoingSelectValue=i;o=k.electionDoingSelectValue!=k.selectValues[k.selectValues.length-1]?_getDisableOptionsList(["-1"]):void 0;return k._setItem(i,void 0,o),!0}return _showMissingCandidatesDialog(),k._gotoStep(1,i),!1}k._setItem(i,void 0,o)}if(k.previousStep==k.currentStep)if(console.log(k.previousStep+" == "+k.currentStep),k.selectValues.indexOf(k.currentSelectValue[k.currentStep])+1<k.selectValues.length){console.log("increase & check");i=k.selectValues[k.selectValues.indexOf(k.currentSelectValue[k.currentStep])+1];if(!_increaseSelectValue(i,o))return!1}else{t.$targetElems.filter('[data-tg="confirm-modal"]')._confirmModal({header:"Fertig",headerClass:"modal-title text-success",body:'<p>Es wurden alle Wahlgänge durchgeführt.<p><p class="mb-0">Falls irgendwo Korrekturen nötig sein sollten, einfach zurück gehen, korrigieren und Wahlen fortsetzen bis zu dieser Meldung.</p>',confirmButtonHide:!0,dismissButtonClass:"btn btn-success",dismissButtonIconClass:"fa fa-check",dismissButtonText:"Ok"}),k.$select[k.currentStep].find("option[disabled]").removeAttr("disabled")}}k._toTop(),void 0!==n&&void 0!==k.$select[k.currentStep]&&k.selectValues.indexOf(n)>=0&&k._setItem(n),console.log("end nav goto "+k.currentStep)},k._prev=function(e){var t=k.currentStep>0?k.currentStep-1:0;k._gotoStep(t,e),k._toTop(),console.log("nav prev "+k.currentStep)},k._next=function(e){var t=k.currentStep<k.steps-1?k.currentStep+1:k.steps-1;k._gotoStep(t,e),k._toTop(),console.log("nav next "+k.currentStep)},k._toTop=function(){t.$functionElems.filter('[data-fn="to-top-wrapper"]').children("a").trigger("click")},k._init=function(){for(var n=0;n<k.steps;n++)k.$electionStep[n]=t.$targetElems.filter(d+n+'"]'),n>0&&(k.$stepPrev[n]=t.$functionElems.filter('[data-fn="election-back-'+n+'"]'),k.$stepPrev[n].on("click",function(e){e.preventDefault(),k._prev()})),n<k.steps&&(k.$stepNext[n]=t.$functionElems.filter(c+n+'"]'),k.$stepNext[n].on("built",function(){k._next()})),n>0&&t.$functionElems.filter(u+n+'"]').length>0&&(k.$select[n]=t.$functionElems.filter(u+n+'"]'),k.currentSelectValue[n]=k.$select[n].val(),console.log("_Nav.currentSelectValue[ "+n+" ]: "+k.currentSelectValue[n]),k.$select[n].on("change",function(){var n=e(this).val(),a=e(this).closest("form"),i=a.find(t.$targetElems.filter('[data-tg="hide-last-item"]'));k.currentSelectValue[k.currentStep]=n,n&&(k.currentItemCoordinates=n.split("_")),console.log("doing select change to: "+n+" – _Nav.currentSelectValue[ "+k.currentStep+" ]: "+(null!=k.currentSelectValue?k.currentSelectValue[k.currentStep]:void 0)+" – _Nav.currentItemCoordinates: "+k.currentItemCoordinates[0]+" "+k.currentItemCoordinates[1]+" "+k.currentItemCoordinates[2]),-1!=n?(a.find("["+p+"]").hide(),a.find("["+p+'^="'+n+'"]').show(),n!=k.selectValues[k.selectValues.length-1]?i.show():i.hide()):(k.currentItemCoordinates=null,a.find("["+p+"]").show(),i.hide())})),1==n&&t.$functionElems.filter('[data-fn="election-next-item"]')&&($nextItemButton=t.$functionElems.filter('[data-fn="election-next-item"]'),$nextItemButton.on("click",function(e){e.preventDefault();var t=k.$select[k.currentStep].val(),a=k.selectValues[k.selectValues.indexOf(t)+1];k.$select[k.currentStep].val(a).trigger("change"),k.currentSelectValue[n]=a,k.currentItemCoordinates=a.split("_"),k._toTop()}));k._gotoStep(k.currentStep)},k._reset=function(){k.currentStep=0,k.previousStep=null,k.selectValues=[],k.currentSelectValue=[],k.electionDoingSelectValue=null,k._gotoStep(k.currentStep)},_saveLocal=function(n){console.log("save");var a=e(n),i="bg-success text-white";t.$functionElems.filter(c+k.currentStep+'"]')["_getElectionCurrentConfig_"+k.currentStep](),localStorage.getItem(o)&&a.addClass(i).delay(300).queue(function(){e(this).removeClass(i).dequeue(),t.$functionElems.filter("#toggle-navbar-collapse").trigger("click")})},t.$functionElems.filter('[data-fn="config-save"]').on("click",function(){_saveLocal(this)}),_resetElection=function(n){localStorage.removeItem(o);var a=void 0!==n?e.extend({},n):e.extend({},i);l=void 0!==n?e.extend({},a):void 0,s=e.extend({},a),_buildStep_0(),k._reset(),t.$targetElems.filter(d+3+'"]').hide()},_downloadCurrentElectionConfig=function(){console.log("save step: "+k.currentStep);var n=k.currentStep<k.steps-1?k.currentStep:k.steps-2;if(t.$functionElems.filter(c+n+'"]')["_getElectionCurrentConfig_"+n](),void 0!==s){var a=t.$targetElems.filter('[data-tg="save-modal"]'),i=a.find('input[name="file_name"]'),o=a.filter(t.$functionElems.find('[data-fn="save-modal-confirm"]')),l=new Date,r=[l.getFullYear(),("00"+(l.getMonth()+1)).slice(-2),("00"+l.getDate()).slice(-2)].join("-")+"_"+[("00"+l.getHours()).slice(-2),("00"+l.getMinutes()).slice(-2),("00"+l.getSeconds()).slice(-2)].join("-");i.val("dib_wahl-checker_"+r).on("focus",function(){e(this).select()}),e.fn._addDownload=function(t){var n=e(this),a=JSON.stringify(s),o=new Blob([a],{type:"application/json"});n.attr("href",URL.createObjectURL(o)).attr("download",i.val()+".json")},a.on("shown.bs.modal",(i=e(i),(o=t.$functionElems.filter('[data-fn="save-modal-confirm"]'))._addDownload(),i.on("change",function(){o._addDownload()}),void setTimeout(function(){i.focus()},550))),o.on("click",function(){t.$targetElems.filter('[data-tg="save-modal"]').modal("hide")}),a.modal("show")}},t.$functionElems.filter('[data-fn="config-download"]').on("click",function(){t.$functionElems.filter("#toggle-navbar-collapse").trigger("click"),_downloadCurrentElectionConfig()}),_loadCurrentElectionConfig=function(){var e,n=t.$targetElems.filter('[data-tg="load-modal"]'),a=n.find("form"),i=a.find('input[name="file_name"]');n.modal("show"),i.on("change",function(t){var n=t.target.files;if(n&&n.length>0){var a=new FileReader;a.onload=(n[0],function(t){try{e=JSON.parse(t.target.result)}catch(e){console.log("error trying to parse json: "+e)}}),a.readAsText(n[0])}}),a.one("submit",function(n){n.preventDefault(),void 0!==e&&(_resetElection(e),t.$targetElems.filter('[data-tg="load-modal"]').modal("hide"),i.val(""))})},t.$functionElems.filter('[data-fn="config-load"]').on("click",function(){t.$functionElems.filter("#toggle-navbar-collapse").trigger("click"),_loadCurrentElectionConfig()}),e.fn._confirmModal=function(t){t=e.extend({},{header:"Bitte bestätigen",headerClass:"modal-title",body:"Bitte bestätige die Aktion.",dismissButtonHide:!1,confirmButtonHide:!1,dismissButtonClass:"btn btn-default",confirmButtonClass:"btn btn-danger",dismissButtonIconClass:"fa fa-close",confirmButtonIconClass:"fa fa-check",dismissButtonText:"Abbrechen",confirmButtonText:"Ok",confirmCallback:null,dismissCallback:null},t);var n=e(this);n.find('[data-g-tg="modal-title"]').html(t.header).attr("class",t.headerClass),n.find('[data-g-tg="modal-body"]').html(t.body);var a=n.find('[data-g-fn="confirm-modal-confirm"]');t.confirmButtonHide?a.hide():(a.attr("class",t.confirmButtonClass).show(),a.find('[data-g-tg="btn-icon"]').attr("class",t.confirmButtonIconClass),a.find('[data-g-tg="btn-text"]').html(t.confirmButtonText));var i=n.find('[data-g-fn="confirm-modal-dismiss"]');t.dismissButtonHide?i.hide():(i.attr("class",t.dismissButtonClass).show(),i.find('[data-g-tg="btn-icon"]').attr("class",t.dismissButtonIconClass),i.find('[data-g-tg="btn-text"]').html(t.dismissButtonText)),n.modal("show"),t.confirmCallback&&a.one("click",function(){t.confirmCallback()}),t.dismissCallback&&n.one("hide.bs.modal",function(){t.dismissCallback()})},t.$functionElems.filter('[data-fn="config-delete"]').on("click",function(){t.$functionElems.filter("#toggle-navbar-collapse").trigger("click");t.$targetElems.filter('[data-tg="confirm-modal"]')._confirmModal({header:"Löschen bestätigen",headerClass:"modal-title text-danger",body:"Möchtest Du wirklich die gesamte Wahl zurücksetzen?",dismissButtonClass:"btn btn-default",confirmButtonClass:"btn btn-danger",dismissButtonIconClass:"fa fa-close",confirmButtonIconClass:"fa fa-trash",dismissButtonText:"Nein, doch nicht",confirmButtonText:"Zurücksetzen",confirmCallback:function(){_resetElection(),t.$targetElems.filter('[data-tg="confirm-modal"]').modal("hide")}})}),e.fn.dibElection=function(){_buildStep_0(),k._init()}}(jQuery,MY_UTILS,DIB_ELECTION_CALCULATOR),function(e,t){e.fn.dropdownMultilevel=function(n){function a(){for(var t=l.length-1;t>=0;t--)e(l[t])._closeDropdown()}function i(o){t.$body.one("click.body",function(t){var r=e(t.target);if(o.length>0)if(-1==e.inArray(r[0],s)){var d=e(o[o.length-1])._getList();d.children().children(n.closeElemSelector).parent().has(r).length>0?(t.preventDefault(),e(o[o.length-1])._closeDropdown(),i(l)):d.has(r).length>0||d.is(r)?i(l):!d.has(r).length>0&&a()}else i(l)})}var o={openedClass:t.classes.open,hasOpenedSublevelClass:"has-"+t.classes.open,animatingClass:t.classes.animating,closeElemSelector:'[data-fn="dropdown-multilevel-close"]',excludedBodyElements:'[data-tg="dropdown-multilevel-excluded"]',scrollDuration:100};n=e.extend({},o,n);var l=[],r=e(this),s=t.$targetElems.filter(n.excludedBodyElements);e.fn._getTarget=function(){var n,a=e(this);if(a.attr(t.attributes.target)){var i=a.attr(t.attributes.target);n=t.$targetElems.filter(i).lenght>0?t.$targetElems.filter(i):e(i)}else n=a.parent("li");return n},e.fn._getList=function(){var t=e(this);return t._getTarget().find('[aria-labelledby="'+t.attr("id")+'"]')},e.fn._getCloseElem=function(){return e(this)._getList().children().fist().find('[data-fn="dropdown-multilevel-close"]')},e.fn._getParentList=function(){return e(this)._getTarget().parent("ul")},e.fn._openDropdown=function(){var t=e(this),a=t._getTarget(),i=t._getParentList();a.addClass(n.openedClass).setRemoveAnimationClass(n.animatingClass),t.ariaExpanded("true"),i.animate({scrollTop:0},n.scrollDuration,function(){e(this).addClass(n.hasOpenedSublevelClass)}),l.push(t)},e.fn._closeDropdown=function(){var t=e(this),a=t._getTarget(),i=t._getParentList();a.removeClass(n.openedClass).setRemoveAnimationClass(n.animatingClass),t.ariaExpanded("false"),i.removeClass(n.hasOpenedSublevelClass),l.pop()},r.each(function(){var n=e(this),o=(n.attr(t.attributes.target),n._getTarget()),r=n._getList();n.on("click",function(s){if(o.length>0&&r.length>0){t.$body.off("click.body");var d=e(s.target),c=e(l[l.length-1]);if(c.has(d).length>0||c.is(d))s.preventDefault(),e(l[l.length-1])._closeDropdown(),l.length>0&&i(l);else if(r.is(":visible")&&r.elemPositionedInside(o.parent()))i(l);else{if(s.preventDefault(),l.length>0){!e(l[l.length-1])._getList().has(n).length>0&&a()}n._openDropdown();var u;(u=n.getOptionsFromAttr())&&u.focusOnOpen&&t.$targetElems.filter(u.focusOnOpen).focus(),s.stopPropagation(),i(l)}}})}),t.$window.on("orientationchange sizeChange",function(){a()})}}(jQuery,MY_UTILS),function(e,t){e.fn.remoteEvent=function(){e(this).each(function(){var n=e(this),a=n.attr(t.attributes.target)||"",i=t.$targetElems.filter(a).lenght>0?t.$targetElems.filter(a):e(a),o=n.getOptionsFromAttr(),l=o.triggerEvent||"click",r=o.remoteEvent||"click";n.on(l,function(){i.length>0&&i.trigger(r)})})}}(jQuery,MY_UTILS),function(e,t){e.fn.toggleToTopButton=function(n){function a(){t.$document.scrollTop()>100?$elem.is("."+n.visibleClass)||$elem.addClass(n.visibleClass):$elem.is("."+n.visibleClass)&&$elem.removeClass(n.visibleClass)}$elem=e(this);var i={threshold:100,visibleClass:t.classes.open};n=e.extend({},i,n),a(),t.$window.on("scroll resize",function(){a()})}}(jQuery,MY_UTILS),function(e,t){e.fn.toggle=function(){e(this).each(function(){var n=e(this),a=n.attr(t.attributes.target)||"",i=t.$targetElems.filter(a).lenght>0?t.$targetElems.filter(a):e(a),o=t.classes.open,l=t.classes.animating;i.getTransitionDuration();n.on("click",function(){i.length>0&&(i.is("."+o)?(i.removeClass(o),n.ariaExpanded("false")):(i.addClass(o),n.ariaExpanded("true")),i.setRemoveAnimationClass(l))})})}}(jQuery,MY_UTILS),function(e,t){t.$functionElems.filter('[data-fn="toggle"]').toggle(),t.$functionElems.filter('[data-fn="dropdown-multilevel"]').dropdownMultilevel(),t.$functionElems.filter('[data-fn="remote-event"]').remoteEvent(),e('a[href^="#"]:not([href="#"])').animatedAnchors({offset:function(){return t.anchorOffsetTop}}),t.$functionElems.filter('[data-fn="to-top-wrapper"]').toggleToTopButton(),t.$functionElems.filter('[data-fn="dib-election-tool"]').dibElection()}(jQuery,MY_UTILS);